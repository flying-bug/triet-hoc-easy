<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>L·ªãch V·∫°n S·ª± - Xem Ng√†y T·ªët X·∫•u</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .date-selector {
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        .date-input {
            background: white;
            border: none;
            border-radius: 10px;
            padding: 12px 15px;
            font-size: 1rem;
            color: #2c3e50;
            font-weight: 600;
            min-width: 120px;
        }

        .lookup-btn {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            border: none;
            border-radius: 10px;
            padding: 12px 25px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .lookup-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(40, 167, 69, 0.3);
        }

        .content {
            padding: 40px;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #6c757d;
        }

        .loading i {
            font-size: 2rem;
            margin-bottom: 15px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .result-section {
            display: none;
        }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .info-card {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 15px;
            padding: 25px;
            border-left: 5px solid #ff6b6b;
            transition: transform 0.3s ease;
        }

        .info-card:hover {
            transform: translateY(-5px);
        }

        .info-card h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.3rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .info-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #dee2e6;
        }

        .info-item:last-child {
            border-bottom: none;
        }

        .info-label {
            font-weight: 600;
            color: #495057;
        }

        .info-value {
            color: #ff6b6b;
            font-weight: 700;
            text-align: right;
            max-width: 60%;
            word-wrap: break-word;
        }

        .feng-shui-section {
            background: linear-gradient(135deg, rgba(255, 107, 107, 0.1) 0%, rgba(238, 90, 36, 0.1) 100%);
            border-radius: 15px;
            padding: 30px;
            margin-top: 30px;
        }

        .feng-shui-section h2 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 25px;
            font-size: 1.8rem;
        }

        .activities-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
            margin-top: 20px;
        }

        .activity-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .good-activities {
            border-left: 5px solid #28a745;
        }

        .bad-activities {
            border-left: 5px solid #dc3545;
        }

        .activity-title {
            font-weight: 700;
            margin-bottom: 15px;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .good-activities .activity-title {
            color: #28a745;
        }

        .bad-activities .activity-title {
            color: #dc3545;
        }

        .activity-list {
            list-style: none;
        }

        .activity-list li {
            padding: 8px 0;
            position: relative;
            padding-left: 25px;
            line-height: 1.4;
        }

        .good-activities .activity-list li:before {
            content: "‚úì";
            position: absolute;
            left: 0;
            color: #28a745;
            font-weight: bold;
            font-size: 1.1rem;
        }

        .bad-activities .activity-list li:before {
            content: "‚úó";
            position: absolute;
            left: 0;
            color: #dc3545;
            font-weight: bold;
            font-size: 1.1rem;
        }

        .error {
            background: #f8d7da;
            color: #721c24;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border-left: 5px solid #dc3545;
        }

        .current-date-display {
            background: rgba(255,255,255,0.2);
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
            text-align: center;
            font-size: 1.1rem;
        }

        .stars-content {
            max-height: 200px;
            overflow-y: auto;
            font-size: 0.9rem;
            line-height: 1.4;
        }

        @media (max-width: 768px) {
            .activities-grid {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .content {
                padding: 20px;
            }

            .date-selector {
                flex-direction: column;
                gap: 10px;
            }

            .date-input {
                width: 100%;
                max-width: 200px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1><i class="fas fa-calendar-check"></i> L·ªãch V·∫°n S·ª±</h1>
            <p>Xem ng√†y t·ªët x·∫•u theo √¢m l·ªãch Vi·ªát Nam</p>
            
            <div class="date-selector">
                <input type="number" id="dayInput" class="date-input" placeholder="Ng√†y" min="1" max="31" value="5">
                <input type="number" id="monthInput" class="date-input" placeholder="Th√°ng" min="1" max="12" value="2">
                <input type="number" id="yearInput" class="date-input" placeholder="NƒÉm" min="1900" max="2100" value="2026">
                <input type="time" id="timeInput" class="date-input" value="06:10">
                <button class="lookup-btn" onclick="lookupDate()">
                    <i class="fas fa-search"></i> Xem Ng√†y
                </button>
            </div>

            <div class="current-date-display" id="currentDateDisplay">
                Ng√†y hi·ªán t·∫°i: Th·ª© 5, 5/2/2026 - 6:10 AM
            </div>
        </div>

        <div class="content">
            <div id="loadingSection" class="loading" style="display: none;">
                <i class="fas fa-spinner"></i>
                <p>ƒêang tra c·ª©u th√¥ng tin l·ªãch v·∫°n s·ª±...</p>
            </div>

            <div id="errorSection" class="error" style="display: none;">
                <i class="fas fa-exclamation-triangle"></i>
                <strong>L·ªói:</strong> <span id="errorMessage">Kh√¥ng th·ªÉ k·∫øt n·ªëi ƒë·∫øn API</span>
            </div>

            <div id="resultSection" class="result-section">
                <div class="info-grid">
                    <div class="info-card">
                        <h3><i class="fas fa-moon"></i> Th√¥ng Tin √Çm L·ªãch</h3>
                        <div class="info-item">
                            <span class="info-label">Ng√†y √¢m l·ªãch:</span>
                            <span class="info-value" id="lunarDate">--</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Can Chi ng√†y:</span>
                            <span class="info-value" id="canChiDay">--</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Can Chi th√°ng:</span>
                            <span class="info-value" id="canChiMonth">--</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Can Chi nƒÉm:</span>
                            <span class="info-value" id="canChiYear">--</span>
                        </div>
                    </div>

                    <div class="info-card">
                        <h3><i class="fas fa-star"></i> Sao T·ªët</h3>
                        <div class="stars-content" id="goodStars">--</div>
                    </div>

                    <div class="info-card">
                        <h3><i class="fas fa-star-half-alt"></i> Sao X·∫•u</h3>
                        <div class="stars-content" id="badStars">--</div>
                    </div>

                    <div class="info-card">
                        <h3><i class="fas fa-clock"></i> Gi·ªù Ho√†ng ƒê·∫°o</h3>
                        <div class="info-item">
                            <span class="info-label">Gi·ªù t·ªët:</span>
                            <span class="info-value" id="goodHours">--</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Tr·∫°ng th√°i:</span>
                            <span class="info-value" id="dayStatus">--</span>
                        </div>
                    </div>

                    <div class="info-card">
                        <h3><i class="fas fa-compass"></i> H∆∞·ªõng V√† Tu·ªïi</h3>
                        <div class="info-item">
                            <span class="info-label">H∆∞·ªõng xu·∫•t h√†nh:</span>
                            <span class="info-value" id="goodDirection">--</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Tu·ªïi xung:</span>
                            <span class="info-value" id="conflictAge">--</span>
                        </div>
                    </div>

                    <div class="info-card">
                        <h3><i class="fas fa-cloud-sun"></i> Th·ªùi Ti·∫øt & Ti·∫øt Kh√≠</h3>
                        <div class="info-item">
                            <span class="info-label">Th·ªùi ti·∫øt:</span>
                            <span class="info-value" id="weather">--</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Ti·∫øt kh√≠:</span>
                            <span class="info-value" id="season">--</span>
                        </div>
                    </div>
                </div>

                <div class="feng-shui-section">
                    <h2><i class="fas fa-yin-yang"></i> Vi·ªác N√™n L√†m & Kh√¥ng N√™n L√†m</h2>
                    
                    <div class="activities-grid">
                        <div class="activity-card good-activities">
                            <div class="activity-title">
                                <i class="fas fa-thumbs-up"></i> Vi·ªác N√™n L√†m
                            </div>
                            <ul class="activity-list" id="goodActivities">
                                <!-- S·∫Ω ƒë∆∞·ª£c c·∫≠p nh·∫≠t t·ª´ API -->
                            </ul>
                        </div>

                        <div class="activity-card bad-activities">
                            <div class="activity-title">
                                <i class="fas fa-thumbs-down"></i> Vi·ªác Kh√¥ng N√™n L√†m
                            </div>
                            <ul class="activity-list" id="badActivities">
                                <!-- S·∫Ω ƒë∆∞·ª£c c·∫≠p nh·∫≠t t·ª´ API -->
                            </ul>
                        </div>
                    </div>

                    <div class="info-card" style="margin-top: 25px;">
                        <h3><i class="fas fa-lightbulb"></i> L·ªùi Khuy√™n Trong Ng√†y</h3>
                        <p id="dailyAdvice" style="color: #2c3e50; line-height: 1.6; font-size: 1.1rem; margin-top: 10px;">
                            <!-- S·∫Ω ƒë∆∞·ª£c c·∫≠p nh·∫≠t t·ª´ API -->
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // API Configuration
        const API_URL = 'https://tuvi.vienaoc.vn/api/v0/lichvansu';
        
        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            updateCurrentDateDisplay();
            // Kh√¥ng t·ª± ƒë·ªông lookup khi load trang
        });

        // Update current date display
        function updateCurrentDateDisplay() {
            const day = document.getElementById('dayInput').value;
            const month = document.getElementById('monthInput').value;
            const year = document.getElementById('yearInput').value;
            const time = document.getElementById('timeInput').value;
            
            const date = new Date(year, month - 1, day);
            const dayNames = ['Ch·ªß Nh·∫≠t', 'Th·ª© 2', 'Th·ª© 3', 'Th·ª© 4', 'Th·ª© 5', 'Th·ª© 6', 'Th·ª© 7'];
            const dayName = dayNames[date.getDay()];
            
            document.getElementById('currentDateDisplay').textContent = 
                `Ng√†y tra c·ª©u: ${dayName}, ${day}/${month}/${year} - ${time}`;
        }

        // Main lookup function
        async function lookupDate() {
            const day = parseInt(document.getElementById('dayInput').value);
            const month = parseInt(document.getElementById('monthInput').value);
            const year = parseInt(document.getElementById('yearInput').value);
            const time = document.getElementById('timeInput').value;
            
            // Validate input
            if (!day || !month || !year || day < 1 || day > 31 || month < 1 || month > 12) {
                showError('Vui l√≤ng nh·∫≠p ng√†y th√°ng nƒÉm h·ª£p l·ªá');
                return;
            }

            // Parse time
            const [hours, minutes] = time.split(':').map(Number);
            
            // Update display
            updateCurrentDateDisplay();
            
            // Show loading
            showLoading();
            
            try {
                // Prepare API request
                const requestData = {
                    gio_duong: hours,
                    phut_duong: minutes,
                    giay_duong: 0,
                    ingay_duong: day,
                    ithang_duong: month,
                    inam_duong: year,
                    timezone: 7
                };

                console.log('üöÄ G·ª≠i request ƒë·∫øn API:', requestData);

                // Call API with timeout
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 15000);

                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json',
                    },
                    body: JSON.stringify(requestData),
                    signal: controller.signal
                });

                clearTimeout(timeoutId);

                console.log('üì• Response status:', response.status);

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const data = await response.json();
                console.log('‚úÖ API Response Data:', data);

                // Process and display results
                displayResults(data);
                
            } catch (error) {
                console.error('‚ùå Lookup Error:', error);
                
                let errorMessage = 'Kh√¥ng th·ªÉ k·∫øt n·ªëi ƒë·∫øn API';
                
                if (error.name === 'AbortError') {
                    errorMessage = 'Timeout: API ph·∫£n h·ªìi qu√° ch·∫≠m';
                } else if (error.message.includes('CORS')) {
                    errorMessage = 'L·ªói CORS: C·∫ßn ch·∫°y qua HTTP server';
                } else if (error.message.includes('Failed to fetch')) {
                    errorMessage = 'L·ªói m·∫°ng: Ki·ªÉm tra k·∫øt n·ªëi internet';
                } else {
                    errorMessage = error.message;
                }
                
                // Show error only, no fallback data
                showError(errorMessage);
            }
        }

        // Display API results - Updated for actual API response structure
        function displayResults(data) {
            hideLoading();
            
            console.log('Processing API data:', data);
            
            // Parse lunar calendar info
            const amLich = data.am_lich || {};
            const duongLich = data.duong_lich || {};
            
            // Update lunar info
            document.getElementById('lunarDate').textContent = 
                amLich.ngay && amLich.thang ? `${amLich.ngay}/${amLich.thang}` : '--';
            
            // Extract Can Chi from various sources
            const canChiNgay = extractCanChi(data.sao_gio_can_chi_display) || '--';
            document.getElementById('canChiDay').textContent = canChiNgay;
            
            // Can Chi month and year from bat_tu or other sources
            const batTu = data.bat_tu || [];
            document.getElementById('canChiMonth').textContent = 
                batTu.length > 1 ? cleanHtmlTags(batTu[1]) : '--';
            document.getElementById('canChiYear').textContent = 
                batTu.length > 0 ? cleanHtmlTags(batTu[0]) : '--';
            
            // Update stars info
            document.getElementById('goodStars').innerHTML = 
                formatStarsText(data.sao_tot) || '--';
            
            document.getElementById('badStars').innerHTML = 
                formatStarsText(data.sao_xau) || '--';
            
            // Day status from hoang_dao
            document.getElementById('dayStatus').textContent = 
                cleanHtmlTags(data.hoang_dao) || cleanHtmlTags(data.luc_nham_don) || '--';
            
            // Update time info - parse gio_hoang_dao
            const gioHoangDao = parseGioHoangDao(data.gio_hoang_dao);
            document.getElementById('goodHours').textContent = gioHoangDao || '--';
            
            // Update direction info
            document.getElementById('goodDirection').textContent = 
                data.huong_xuat_hanh ? data.huong_xuat_hanh.replace(/;/g, ', ') : '--';
            
            document.getElementById('conflictAge').innerHTML = 
                formatConflictAge(data.tuoi_xung) || '--';
            
            // Update weather and season
            document.getElementById('weather').innerHTML = 
                formatWeatherText(data.thoi_tiet) || '--';
            document.getElementById('season').textContent = 
                data.tiet_khi_truoc || '--';
            
            // Parse activities from sao_tot and sao_xau
            const activities = parseActivitiesFromStars(data.sao_tot, data.sao_xau);
            
            // Add activities from nhi_thap_bat_tu (28 stars)
            const nhiThapBatTu = parseNhiThapBatTu(data.nhi_thap_bat_tu, data.luan_nhi_thap_bat_tu);
            if (nhiThapBatTu.good) {
                activities.good = activities.good ? [...activities.good, ...nhiThapBatTu.good] : nhiThapBatTu.good;
            }
            if (nhiThapBatTu.bad) {
                activities.bad = activities.bad ? [...activities.bad, ...nhiThapBatTu.bad] : nhiThapBatTu.bad;
            }
            
            updateActivities(activities.good, activities.bad);
            
            // Update advice based on day status and weather
            const advice = generateAdvice(data);
            document.getElementById('dailyAdvice').textContent = advice;
            
            // Show results
            document.getElementById('resultSection').style.display = 'block';
        }

        // Helper function to clean HTML tags
        function cleanHtmlTags(text) {
            if (!text) return '';
            return text.replace(/<[^>]*>/g, '').replace(/&nbsp;/g, ' ').trim();
        }

        // Format stars text with proper HTML
        function formatStarsText(text) {
            if (!text) return '';
            
            // Convert <b> and <i> tags to proper formatting
            let formatted = text
                .replace(/<b>/g, '<strong>')
                .replace(/<\/b>/g, '</strong>')
                .replace(/<i>/g, '<em>')
                .replace(/<\/i>/g, '</em>')
                .replace(/<\/br>/g, '<br>')
                .replace(/\n/g, '<br>');
            
            return formatted;
        }

        // Format weather text
        function formatWeatherText(text) {
            if (!text) return '';
            return text.replace(/<span[^>]*>/g, '').replace(/<\/span>/g, '');
        }

        // Format conflict age
        function formatConflictAge(text) {
            if (!text) return '';
            return text.replace(/<span[^>]*>/g, '').replace(/<\/span>/g, '').replace(/,/g, ', ');
        }

        // Extract Can Chi from gio data
        function extractCanChi(gioData) {
            if (!gioData) return null;
            
            // Get current hour Can Chi (assuming 6:10 AM = hour 6)
            const currentHour = parseInt(document.getElementById('timeInput').value.split(':')[0]);
            const hourIndex = Math.floor(currentHour / 2) * 2; // Convert to traditional hour system
            
            if (gioData[hourIndex]) {
                return cleanHtmlTags(gioData[hourIndex]);
            }
            
            // Fallback to first available
            const firstKey = Object.keys(gioData)[0];
            return firstKey ? cleanHtmlTags(gioData[firstKey]) : null;
        }

        // Parse gio hoang dao for good hours
        function parseGioHoangDao(gioText) {
            if (!gioText) return '';
            
            const cleanText = cleanHtmlTags(gioText);
            const hours = cleanText.split(',').map(h => h.trim()).filter(h => h);
            
            return hours.join(', ');
        }

        // Parse activities from 28 stars (nhi_thap_bat_tu)
        function parseNhiThapBatTu(nhiThapBatTu, luanNhiThapBatTu) {
            const goodActivities = [];
            const badActivities = [];
            
            // Parse from nhi_thap_bat_tu string
            if (nhiThapBatTu) {
                const text = cleanHtmlTags(nhiThapBatTu);
                console.log('28 sao t√∫:', text);
                
                if (text.includes('T·ªët')) {
                    if (text.includes('mai t√°ng x·∫•u')) {
                        goodActivities.push('C√°c vi·ªác t·ªët (tr·ª´ tang l·ªÖ)');
                        badActivities.push('Tang l·ªÖ, mai t√°ng');
                    } else {
                        goodActivities.push('C√°c vi·ªác theo 28 sao t√∫ ƒë·ªÅu t·ªët');
                    }
                }
                
                if (text.includes('X·∫•u') || text.includes('Hung')) {
                    badActivities.push('Tr√°nh c√°c vi·ªác quan tr·ªçng theo 28 sao t√∫');
                }
            }
            
            // Parse from luan_nhi_thap_bat_tu object
            if (luanNhiThapBatTu && luanNhiThapBatTu.title) {
                const title = cleanHtmlTags(luanNhiThapBatTu.title);
                console.log('Lu·∫≠n 28 sao t√∫:', title);
                
                if (title.includes('T·ªët')) {
                    if (title.includes('mai t√°ng x·∫•u') || title.includes('tang x·∫•u')) {
                        goodActivities.push('M·ªçi vi·ªác t·ªët (tr·ª´ tang l·ªÖ)');
                        badActivities.push('Tang l·ªÖ, mai t√°ng, vi·ªác tang');
                    } else {
                        goodActivities.push('M·ªçi vi·ªác ƒë·ªÅu thu·∫≠n l·ª£i');
                    }
                }
                
                if (title.includes('X·∫•u') || title.includes('Hung')) {
                    badActivities.push('Tr√°nh m·ªçi vi·ªác quan tr·ªçng');
                }
                
                // Specific star interpretations
                if (title.includes('Giao Long')) {
                    goodActivities.push('Giao d·ªãch, h·ª£p t√°c kinh doanh');
                }
                if (title.includes('Ti·∫øt L·∫≠p')) {
                    goodActivities.push('B·∫Øt ƒë·∫ßu vi·ªác m·ªõi theo ti·∫øt kh√≠');
                }
            }
            
            return {
                good: goodActivities.length > 0 ? [...new Set(goodActivities)] : null,
                bad: badActivities.length > 0 ? [...new Set(badActivities)] : null
            };
        }

        // Parse activities from star descriptions - Enhanced version
        function parseActivitiesFromStars(saoTot, saoXau) {
            const goodActivities = [];
            const badActivities = [];
            
            if (saoTot) {
                const cleanSaoTot = cleanHtmlTags(saoTot);
                console.log('Sao t·ªët:', cleanSaoTot);
                
                // Parse specific activities from sao_tot
                if (cleanSaoTot.includes('T·ªët m·ªçi vi·ªác')) {
                    goodActivities.push('M·ªçi vi·ªác ƒë·ªÅu thu·∫≠n l·ª£i');
                }
                if (cleanSaoTot.includes('c·∫ßu ph√∫c') || cleanSaoTot.includes('t·∫ø t·ª±')) {
                    goodActivities.push('C·∫ßu nguy·ªán, th·ªù c√∫ng, l·ªÖ b√°i');
                }
                if (cleanSaoTot.includes('Ho√†ng ƒê·∫°o')) {
                    goodActivities.push('C√°c vi·ªác quan tr·ªçng, kh·ªüi s·ª±');
                }
                if (cleanSaoTot.includes('Thi√™n ƒê·ª©c') || cleanSaoTot.includes('Nguy·ªát ƒê·ª©c')) {
                    goodActivities.push('C∆∞·ªõi h·ªèi, ƒÉn h·ªèi');
                    goodActivities.push('Kh·ªüi c√¥ng x√¢y d·ª±ng');
                }
                if (cleanSaoTot.includes('Thi√™n √Çn')) {
                    goodActivities.push('Khai tr∆∞∆°ng, kinh doanh');
                    goodActivities.push('K√Ω h·ª£p ƒë·ªìng');
                }
                if (cleanSaoTot.includes('Thanh Long')) {
                    goodActivities.push('Du l·ªãch, xu·∫•t h√†nh');
                    goodActivities.push('H·ªçc t·∫≠p, thi c·ª≠');
                }
            }
            
            if (saoXau) {
                const cleanSaoXau = cleanHtmlTags(saoXau);
                console.log('Sao x·∫•u:', cleanSaoXau);
                
                // Parse specific restrictions from sao_xau
                if (cleanSaoXau.includes('X·∫•u m·ªçi vi·ªác')) {
                    badActivities.push('Tr√°nh c√°c vi·ªác quan tr·ªçng');
                }
                if (cleanSaoXau.includes('K·ªã x√¢y d·ª±ng') || cleanSaoXau.includes('ƒê·ªãa ph√°')) {
                    badActivities.push('Kh·ªüi c√¥ng x√¢y d·ª±ng, ƒë·ªông th·ªï');
                }
                if (cleanSaoXau.includes('K·ªã xu·∫•t h√†nh') || cleanSaoXau.includes('Ng≈© Qu·ª∑')) {
                    badActivities.push('Du l·ªãch, xu·∫•t h√†nh xa');
                }
                if (cleanSaoXau.includes('K·ªã gi√° th√∫') || cleanSaoXau.includes('Ly s√†ng') || cleanSaoXau.includes('Kh√¥ng ph√≤ng')) {
                    badActivities.push('C∆∞·ªõi h·ªèi, ƒÉn h·ªèi, l·ªÖ th√†nh h√¥n');
                }
                if (cleanSaoXau.includes('K·ªã kh·ªüi t·∫°o') || cleanSaoXau.includes('Ng≈© h∆∞')) {
                    badActivities.push('B·∫Øt ƒë·∫ßu vi·ªác m·ªõi, khai tr∆∞∆°ng');
                }
                if (cleanSaoXau.includes('K·ªã an t√°ng') || cleanSaoXau.includes('mai t√°ng x·∫•u')) {
                    badActivities.push('Tang l·ªÖ, an t√°ng');
                }
                if (cleanSaoXau.includes('Tam n∆∞∆°ng')) {
                    badActivities.push('C√°c vi·ªác gia ƒë√¨nh (theo d√¢n gian)');
                }
                if (cleanSaoXau.includes('Thi√™n C∆∞∆°ng') || cleanSaoXau.includes('Di·ªát M√¥n')) {
                    badActivities.push('K√Ω h·ª£p ƒë·ªìng quan tr·ªçng');
                }
                if (cleanSaoXau.includes('Nguy·ªát H√¨nh')) {
                    badActivities.push('Ph·∫´u thu·∫≠t, can thi·ªáp y t·∫ø');
                }
            }
            
            return {
                good: goodActivities.length > 0 ? goodActivities : null,
                bad: badActivities.length > 0 ? badActivities : null
            };
        }

        // Generate advice based on API data
        function generateAdvice(data) {
            let advice = '';
            
            const hoangDao = cleanHtmlTags(data.hoang_dao || '');
            const lucNhamDon = cleanHtmlTags(data.luc_nham_don || '');
            const thoiTiet = cleanHtmlTags(data.thoi_tiet || '');
            
            if (hoangDao.includes('Ho√†ng ƒê·∫°o')) {
                advice += 'H√¥m nay l√† ng√†y Ho√†ng ƒê·∫°o, r·∫•t t·ªët cho c√°c vi·ªác quan tr·ªçng. ';
            }
            
            if (lucNhamDon.includes('C√°t')) {
                advice += 'Ng√†y c√≥ nhi·ªÅu may m·∫Øn v√† thu·∫≠n l·ª£i. ';
            }
            
            if (thoiTiet) {
                advice += `Th·ªùi ti·∫øt h√¥m nay: ${thoiTiet.replace('M√πa ƒê√¥ng', 'm√πa ƒë√¥ng')}. `;
            }
            
            advice += 'H√£y t·∫≠n d·ª•ng nh·ªØng gi·ªù ho√†ng ƒë·∫°o ƒë·ªÉ l√†m vi·ªác v√† tr√°nh nh·ªØng vi·ªác kh√¥ng ph√π h·ª£p trong ng√†y.';
            
            return advice || 'H√£y gi·ªØ t√¢m tr·∫°ng t√≠ch c·ª±c v√† l√†m vi·ªác c√≥ k·∫ø ho·∫°ch trong ng√†y h√¥m nay.';
        }

        // Update activities lists
        function updateActivities(goodList, badList) {
            const goodActivitiesEl = document.getElementById('goodActivities');
            const badActivitiesEl = document.getElementById('badActivities');
            
            // Only use API data, no defaults
            if (goodList && goodList.length > 0) {
                goodActivitiesEl.innerHTML = goodList.slice(0, 8).map(activity => 
                    `<li>${activity}</li>`
                ).join('');
            } else {
                goodActivitiesEl.innerHTML = '<li>Kh√¥ng c√≥ th√¥ng tin</li>';
            }
            
            if (badList && badList.length > 0) {
                badActivitiesEl.innerHTML = badList.slice(0, 8).map(activity => 
                    `<li>${activity}</li>`
                ).join('');
            } else {
                badActivitiesEl.innerHTML = '<li>Kh√¥ng c√≥ th√¥ng tin</li>';
            }
        }

        // UI Helper functions
        function showLoading() {
            document.getElementById('loadingSection').style.display = 'block';
            document.getElementById('errorSection').style.display = 'none';
            document.getElementById('resultSection').style.display = 'none';
        }

        function hideLoading() {
            document.getElementById('loadingSection').style.display = 'none';
        }

        function showError(message) {
            document.getElementById('errorMessage').textContent = message;
            document.getElementById('errorSection').style.display = 'block';
            document.getElementById('loadingSection').style.display = 'none';
            document.getElementById('resultSection').style.display = 'none';
        }

        // Auto-update date display when inputs change
        document.getElementById('dayInput').addEventListener('change', updateCurrentDateDisplay);
        document.getElementById('monthInput').addEventListener('change', updateCurrentDateDisplay);
        document.getElementById('yearInput').addEventListener('change', updateCurrentDateDisplay);
        document.getElementById('timeInput').addEventListener('change', updateCurrentDateDisplay);

        // Enter key support
        document.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                lookupDate();
            }
        });
    </script>
</body>
</html>